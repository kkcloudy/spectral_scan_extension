"use strict";(self.webpackChunkcom_rak_ht=self.webpackChunkcom_rak_ht||[]).push([[181],{3181:function(e,t,n){n.r(t);var a,o=n(3264),r=n(3644),i=n(272),s=n(928),l=n(6660),c=n(1610);!function(e){e.CONFIGURATION="configuration"}(a||(a={}));var d=[{value:a.CONFIGURATION,name:"configuration"}],u=["extensions","spectralScan"],m=n(6417),h=function(e){var t=e.activeTab,n=e.breadcrumbs,a=e.handleChangeTab,o=(0,s.useIntl)().formatMessage,r=d.map((function(e){var t=e.name;return{value:e.value,name:o({id:t})}})),i=n.map((function(e){return o({id:e})}));return(0,m.jsx)(l.PageHeader,{withCustomElement:!0,activeTab:t,tabs:r,handleChangeTab:a,title:(0,m.jsx)(s.FormattedMessage,{id:"spectralScan"}),customElement:(0,m.jsx)(c.Breadcrumbs,{breadcrumbs:i})})},p=n(9749),b=n(4072),f=n(6929),g=n(1985),x=n(866),S=n(8541),v=n(4790),y={start_frequency:863100,channel_number:16,step:200},C=n(2889),F=function(){var e=function(){var e=(0,s.useIntl)().formatMessage;return(0,C.object)({start_frequency:(0,C.number)(),channel_number:(0,C.number)(),point_number:(0,C.number)(),rssi_offset:(0,C.number)(),masked:(0,C.string)(),file:(0,C.object)(),text:(0,C.string)().when(["switch"],(function(t){return t?(0,C.string)().min(3,e({id:"thisFieldShouldBeAtLeast"},{length:3})).max(15,e({id:"thisFieldShouldNotBeLongerThen"},{length:15})).matches(/[0-9A-Za-z]/g,e({id:"invalidCharacters"})).required(e({id:"thisFieldCannotBeEmpty"})):(0,C.string)()})),textarea:(0,C.string)(),select:(0,C.string)(),radio:(0,C.string)(),switch:(0,C.boolean)(),number:(0,C.string)(),numbers:(0,C.array)().when(["switch"],(function(t){return t?(0,C.array)().min(1,e({id:"youCannotAddLessThanMinItems"},{min:1})).max(3,e({id:"youCannotAddMoreThanMaxItems"},{max:3})):(0,C.array)()}))})}(),t=(0,S.useForm)({mode:"onChange",delayError:void 0,shouldFocusError:!0,shouldUnregister:!1,reValidateMode:"onChange",criteriaMode:"firstError",defaultValues:y,resolver:(0,v.X)(e),shouldUseNativeValidation:!1}),n=t.reset,a=t.control,o=t.register,r=t.setValue,i=t.getValues,l=t.handleSubmit,c=t.formState,d=c.errors,u=c.isDirty,m=c.isSubmitting;return{reset:n,errors:d,control:a,setValue:r,register:o,getValues:i,showConfirm:u&&!m,handleSubmit:l,isDisabledSubmit:!1}},k=n(3433),T=n(9439),w=n(5861),E=n(1413),N=n(7757),j=n.n(N),B=n(451),I=n.n(B),Z=n(4086),_=n(9165),A="/extensions/com_rak_spectral_scan/enable",L=(0,_.createRequestAction)({type:"GET_ENABLE",payload:function(){return{url:A,method:"GET"}}}),R=(0,T.Z)(L,1)[0],W=(0,_.createRequestAction)({type:"SET_ENABLE",payload:function(e){var t=e.data;return{url:A,method:"PUT",data:t}},meta:{skipToast:!0}}),z=(0,T.Z)(W,1)[0],O=n(4942),q=n(7959),M=n(2045),U=n(5631),H=n(4040),G=n(3195),P=n(5585),V=n(9438),D=n(4963),J=n(1749),K=n(2157),Q=n(1537),X=function(e){var t=e.xaxis,n=e.yaxis,a=e.data;H.D([G.N,V.N,D.N,M.N,J.N,K.N,Q.N]);var o={position:"relative",tooltip:{position:"top",axisPointer:{type:"cross",label:{backgroundColor:"#fff",color:"#555",fontSize:"12px",fontWeight:500}}},toolbox:{show:!0},animation:!1,grid:{top:"80",left:"45",right:"80",bottom:"60"},xAxis:{type:"category",data:t,name:"FREQ(KHz)",nameTextStyle:{fontSize:10,color:"#000000"},axisLine:{lineStyle:{color:"#CECECE"}},axisTick:{alignWithLabel:!1},splitArea:{show:!0},maxInterval:1,axisLabel:{lineHeight:16,color:"#B4B4B4",interval:0,fontSize:11}},yAxis:{type:"category",data:n,name:"Time",axisTick:{alignWithLabel:!0},nameTextStyle:{fontSize:10,color:"#000000"},axisLine:{lineStyle:{color:"#CECECE"}},axisLabel:{lineHeight:16,color:"#B4B4B4",fontSize:10},position:"left"},visualMap:{min:-135,max:-11,calculable:!0,orient:"horizontal",top:"0px",right:"80px",itemHeight:"200px",itemWidth:"12px",text:["","RSSI(dB)"],fontSize:"22px",inRange:{color:["#0000FF","#00FFFF","#00FF00","#FFFF00","#FFA500","#FF0000","#FF00FF"]},indicatorIcon:"none",hoverLink:!1},series:[{name:"RSSI",type:"heatmap",data:a,label:{show:!1}}]};return(0,m.jsx)("div",{children:(0,m.jsx)(P.Z,{lazyUpdate:!0,echarts:U,option:o,style:{height:"100%",minHeight:"600px",width:"100%"}})})},Y=(0,i.makeStyles)((function(e){var t;return(0,i.createStyles)({form:(0,E.Z)((0,E.Z)({},(0,q.formWrapExpansion)(e)),{},(0,O.Z)({background:e.custom.white,minHeight:"calc(100vh - 300px)",boxSizing:"border-box",padding:"60px 30px"},e.breakpoints.down(e.breakpoints.values.mobile),{padding:"32px 20px"})),formBlock:(t={maxWidth:"368px",display:"grid",gap:"24px",gridTemplateColumns:"168px 168px","& #mui-component-select-select:focus":{backgroundColor:"transparent"}},(0,O.Z)(t,e.breakpoints.down(e.breakpoints.values.mobile),{paddingBottom:"20px"}),(0,O.Z)(t,"marginBottom","36px"),t),infoBlock:{maxWidth:"368px"},submit:{height:"48px",width:"120px"},loaderWrap:{width:"fit-content",margin:"20% auto"},circle:{color:e.palette.primary.light},fieldWithPills:{display:"grid",gridTemplateColumns:"168px 1fr",gridColumnGap:"32px"},pillsList:{padding:"20px 0 0 0",display:"flex",flexWrap:"wrap",gridColumn:"span 2"},addButton:{width:"80px",alignSelf:"start",transform:"translate(-11px, 22px)"},heatMap:{display:"grid",placeItems:"center"},dataTable:{width:"100%",borderCollapse:"collapse"},tableHeader:{backgroundColor:"#f2f2f2"},tableCell:{border:"1px solid #ddd",padding:"8px",textAlign:"left"},tableRow:{"&:hover":{backgroundColor:"lightblue"}}})}),{name:"ConfigurationTab"}),$=function(){var e=Y(),t=(0,s.useIntl)().formatMessage,n=F(),a=n.reset,r=n.control,i=n.handleSubmit,l=function(e){var t=e.reset;(0,o.useEffect)((function(){t((0,E.Z)({},{start_frequency:863100,channel_number:16,step:200,rssi_offset:-11}))}),[]);var n=(0,Z.useApiRequest)(R),a=(0,Z.useApiRequest)(z),r=(0,o.useCallback)((0,w.Z)(j().mark((function e(){var t,a,o;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:a=e.sent,o=null===a||void 0===a||null===(t=a.payload)||void 0===t?void 0:t.payload,a&&!I()(o)&&ee(o.enable);case 5:case"end":return e.stop()}}),e)}))),[n]);(0,o.useEffect)((function(){r()}),[]);var i=(0,o.useState)(null),s=(0,T.Z)(i,2),l=s[0],c=s[1],d=(0,o.useState)(!1),u=(0,T.Z)(d,2),m=u[0],h=u[1],p=(0,o.useState)(!1),b=(0,T.Z)(p,2),f=b[0],g=b[1],x=(0,o.useState)(!1),S=(0,T.Z)(x,2),v=S[0],y=S[1],C=(0,o.useState)(!1),F=(0,T.Z)(C,2),N=F[0],B=F[1],_=(0,o.useState)([]),A=(0,T.Z)(_,2),L=A[0],W=A[1],O=(0,o.useState)([]),q=(0,T.Z)(O,2),M=q[0],U=q[1],H=(0,o.useState)([]),G=(0,T.Z)(H,2),P=G[0],V=G[1],D=(0,o.useState)(0),J=(0,T.Z)(D,2),K=J[0],Q=J[1],X=(0,o.useState)(!1),Y=(0,T.Z)(X,2),$=Y[0],ee=Y[1],te=function(e){var t="wss://".concat(window.location.hostname,":5000");if(l&&l.readyState!==WebSocket.CLOSED)console.log("WebSocket is already connected or connecting");else{var n=new WebSocket(t,"websocket-protocol");c(n),n.onopen=function(){if(console.log("WebSocket connected"),h(!0),g(!0),console.log(e),"object"==typeof e){localStorage.setItem("localConfig",e);var t=Array.from({length:e.channel_number},(function(t,n){return n*e.step+e.start_frequency}));W(t),U([]),Q(0),V([]);var a=JSON.stringify(e);localStorage.setItem("localConfig",a),n.send(a)}else{var o=JSON.parse(e),r=Array.from({length:o.channel_number},(function(e,t){return t*o.step+o.start_frequency}));W(r),n.send("reconnect")}},n.onmessage=function(e){console.log("Message received:",e.data);var t=e.data.split(",").map(Number);console.log(t),console.log(K);var n=[],a=(new Date).toLocaleString("zh-CN");U((function(e){return[].concat((0,k.Z)(e),[a])})),Q((function(e){return console.log("Previous count:",e),n=t.map((function(t,n){return[n,e,-4*t-11]})),e+1})),V((function(e){return[].concat((0,k.Z)(e),(0,k.Z)(n))})),B(!0)},n.onclose=function(){console.log("WebSocket disconnected")},n.onerror=function(e){console.error("WebSocket error:",e)}}},ne=(0,o.useCallback)((0,w.Z)(j().mark((function e(){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ee((function(e){return!e})),e.next=3,a({data:{enable:!$}});case 3:case"end":return e.stop()}}),e)}))),[a,$]);return(0,o.useEffect)((function(){var e=localStorage.getItem("localConfig");e&&(console.log("Reconnecting to WebSocket:",e),te(e))}),[]),{xaxis:L,yaxis:M,data:P,showResult:N,isConnected:m,isStartLoad:f,isStopLoad:v,isEnabled:$,handleStart:te,handleStop:function(){g(!1),y(!0),l&&(l.send("stop"),l.close()),c(null),localStorage.removeItem("localConfig"),setTimeout((function(){h(!1),y(!1)}),15e3)},handleEnable:ne}}({reset:a}),c=l.xaxis,d=l.yaxis,u=l.data,h=l.showResult,S=l.isConnected,v=l.isStartLoad,y=l.isStopLoad,C=l.isEnabled,N=l.handleStart,B=l.handleStop,_=l.handleEnable;return(0,m.jsx)("div",{children:(0,m.jsxs)("form",{onSubmit:i(N),className:e.form,children:[(0,m.jsx)(b.FormBlock,{label:t({id:"enableService"}),children:(0,m.jsx)(x.SwitchField,{label:t({id:"Enable"}),checked:C,onChange:_,tooltipText:"If you enable spectral scan, other LoRa service will be stopped."})}),C&&(0,m.jsxs)(b.FormBlock,{label:t({id:"option"}),children:[(0,m.jsxs)("div",{className:e.formBlock,children:[(0,m.jsx)(g.TextFormField,{name:"start_frequency",shouldUnregister:!0,control:r,label:t({id:"startFrequency"})}),(0,m.jsx)(g.TextFormField,{name:"channel_number",shouldUnregister:!0,control:r,label:t({id:"channelNumber"})}),(0,m.jsx)(g.TextFormField,{name:"step",shouldUnregister:!0,control:r,label:t({id:"step"})})]}),(0,m.jsxs)("div",{className:e.formBlock,children:[(0,m.jsx)(f.CustomButton,{type:"submit",variant:"contained",customSize:"small",disabled:S,loading:v,additionalClass:e.submit,children:t({id:"startScan"})}),(0,m.jsx)(f.CustomButton,{variant:"contained",customSize:"small",disabled:!S,loading:y,onClick:B,additionalClass:e.submit,children:t({id:"stopScan"})})]})]}),h&&C&&(0,m.jsx)(X,{xaxis:c,yaxis:d,data:u}),(0,m.jsx)(p.DevTool,{control:r})]})})},ee={en:JSON.parse('{"extensions":"Extensions","configuration":"Configuration","spectralScan":"Spectral Scan","enable":"Enable","enableService":"Enable Service","option":"Scan Configuration","startFrequency":"Start Frequency (KHz)","channelNumber":"Channel Number","step":"Steps (KHz)","rssiOffset":"RSSI Offset (dB)","result":"Scan Result","startScan":"Start","stopScan":"Stop","thisFieldShouldBeAtLeast":"This field should be at least {length} character(s) long.","thisFieldShouldNotBeLongerThen":"This field should not be longer than {length}.","invalidCharacters":"Invalid characters. Please check the input.","thisFieldCannotBeEmpty":"This field cannot be empty."}')},te=function(){var e=(0,o.useState)(a.CONFIGURATION),t=(0,T.Z)(e,2),n=t[0],r=t[1],i=(0,o.useCallback)((function(e,t){n!==a.CONFIGURATION&&r(t)}),[n]);return{activeTab:n,breadcrumbs:u,handleChangeTab:i}},ne=function(){var e=te(),t=e.activeTab,n=e.breadcrumbs,o=e.handleChangeTab;return(0,m.jsx)(s.IntlProvider,{locale:"en",messages:ee.en,children:(0,m.jsxs)("div",{children:[(0,m.jsx)(h,{activeTab:t,breadcrumbs:n,handleChangeTab:o}),t===a.CONFIGURATION&&(0,m.jsx)($,{})]})})},ae=n(6725),oe=n(673),re=function(){return(0,m.jsxs)(i.MuiThemeProvider,{theme:ae.theme,children:[(0,m.jsx)(oe.GlobalStyles,{}),(0,m.jsx)(ne,{})]})};r.render((0,m.jsx)(o.StrictMode,{children:(0,m.jsx)(re,{})}),document.getElementById("root"))}}]);