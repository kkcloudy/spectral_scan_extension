"use strict";(self.webpackChunkcom_rak_ht=self.webpackChunkcom_rak_ht||[]).push([[219],{9538:function(e,t,n){n.d(t,{n:function(){return h}});var a=n(2045),o=n(4040),r=n(5631),i=n(3195),s=n(5585),l=n(9438),c=n(4963),u=n(1749),d=n(2157),f=n(1537),m=n(6417),h=function(e){var t=e.xaxis,n=e.yaxis,h=e.data;o.D([i.N,l.N,c.N,a.N,u.N,d.N,f.N]);var p={position:"relative",tooltip:{position:"top",axisPointer:{type:"cross",label:{backgroundColor:"#fff",color:"#555",fontSize:"12px",fontWeight:500}}},toolbox:{show:!0},animation:!1,grid:{top:"80",left:"45",right:"80",bottom:"60"},xAxis:{type:"category",data:t,name:"FREQ(KHz)",nameTextStyle:{fontSize:10,color:"#000000"},axisLine:{lineStyle:{color:"#CECECE"}},axisTick:{alignWithLabel:!1},splitArea:{show:!0},maxInterval:1,axisLabel:{lineHeight:16,color:"#B4B4B4",interval:0,fontSize:11}},yAxis:{type:"category",data:n,name:"Time",axisTick:{alignWithLabel:!0},nameTextStyle:{fontSize:10,color:"#000000"},axisLine:{lineStyle:{color:"#CECECE"}},axisLabel:{lineHeight:16,color:"#B4B4B4",fontSize:10},position:"left"},visualMap:{min:-135,max:-11,calculable:!0,orient:"horizontal",top:"0px",right:"80px",itemHeight:"200px",itemWidth:"12px",text:["","RSSI(dB)"],fontSize:"22px",inRange:{color:["#0000FF","#00FFFF","#00FF00","#FFFF00","#FFA500","#FF0000","#FF00FF"]},indicatorIcon:"none",hoverLink:!1},series:[{name:"RSSI",type:"heatmap",data:h,label:{show:!1}}]};return(0,m.jsx)("div",{children:(0,m.jsx)(s.Z,{lazyUpdate:!0,echarts:r,option:p,style:{height:"100%",minHeight:"600px",width:"100%"}})})}},3232:function(e,t,n){n.d(t,{S:function(){return a}});var a={start_frequency:863100,channel_number:16,step:200}},555:function(e,t,n){n.d(t,{Q:function(){return h}});var a=n(3433),o=n(9439),r=n(5861),i=n(1413),s=n(7757),l=n.n(s),c=n(3264),u=n(451),d=n.n(u),f=n(4086),m=n(8104),h=function(e){var t=e.reset;(0,c.useEffect)((function(){t((0,i.Z)({},{start_frequency:863100,channel_number:16,step:200,rssi_offset:-11}))}),[]);var n=(0,f.useApiRequest)(m.G),s=(0,f.useApiRequest)(m.n),u=(0,c.useCallback)((0,r.Z)(l().mark((function e(){var t,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:a=e.sent,o=null===a||void 0===a||null===(t=a.payload)||void 0===t?void 0:t.payload,a&&!d()(o)&&$(o.enable);case 5:case"end":return e.stop()}}),e)}))),[n]);(0,c.useEffect)((function(){u()}),[]);var h=(0,c.useState)(null),p=(0,o.Z)(h,2),b=p[0],g=p[1],x=(0,c.useState)(!1),S=(0,o.Z)(x,2),v=S[0],C=S[1],y=(0,c.useState)(!1),F=(0,o.Z)(y,2),k=F[0],T=F[1],w=(0,c.useState)(!1),I=(0,o.Z)(w,2),E=I[0],N=I[1],B=(0,c.useState)(!1),j=(0,o.Z)(B,2),Z=j[0],A=j[1],_=(0,c.useState)([]),L=(0,o.Z)(_,2),R=L[0],z=L[1],W=(0,c.useState)([]),O=(0,o.Z)(W,2),q=O[0],H=O[1],M=(0,c.useState)([]),U=(0,o.Z)(M,2),G=U[0],P=U[1],V=(0,c.useState)(0),D=(0,o.Z)(V,2),K=D[0],J=D[1],Q=(0,c.useState)(!1),X=(0,o.Z)(Q,2),Y=X[0],$=X[1],ee=function(e){var t="wss://".concat(window.location.hostname,":5000");if(b&&b.readyState!==WebSocket.CLOSED)console.log("WebSocket is already connected or connecting");else{var n=new WebSocket(t,"websocket-protocol");g(n),n.onopen=function(){if(console.log("WebSocket connected"),C(!0),T(!0),console.log(e),"object"==typeof e){localStorage.setItem("localConfig",e);var t=Array.from({length:e.channel_number},(function(t,n){return n*e.step+e.start_frequency}));z(t),H([]),J(0),P([]);var a=JSON.stringify(e);localStorage.setItem("localConfig",a),n.send(a)}else{var o=JSON.parse(e),r=Array.from({length:o.channel_number},(function(e,t){return t*o.step+o.start_frequency}));z(r),n.send("reconnect")}},n.onmessage=function(e){console.log("Message received:",e.data);var t=e.data.split(",").map(Number);console.log(t),console.log(K);var n=[],o=(new Date).toLocaleString("zh-CN");H((function(e){return[].concat((0,a.Z)(e),[o])})),J((function(e){return console.log("Previous count:",e),n=t.map((function(t,n){return[n,e,-4*t-11]})),e+1})),P((function(e){return[].concat((0,a.Z)(e),(0,a.Z)(n))})),A(!0)},n.onclose=function(){console.log("WebSocket disconnected")},n.onerror=function(e){console.error("WebSocket error:",e)}}},te=(0,c.useCallback)((0,r.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $((function(e){return!e})),e.next=3,s({data:{enable:!Y}});case 3:case"end":return e.stop()}}),e)}))),[s,Y]);return(0,c.useEffect)((function(){var e=localStorage.getItem("localConfig");e&&(console.log("Reconnecting to WebSocket:",e),ee(e))}),[]),{xaxis:R,yaxis:q,data:G,showResult:Z,isConnected:v,isStartLoad:k,isStopLoad:E,isEnabled:Y,handleStart:ee,handleStop:function(){T(!1),N(!0),b&&(b.send("stop"),b.close()),g(null),localStorage.removeItem("localConfig"),setTimeout((function(){C(!1),N(!1)}),15e3)},handleEnable:te}}},1477:function(e,t,n){n.d(t,{t:function(){return s}});var a=n(8541),o=n(4790),r=n(3232),i=n(7923),s=function(){var e=(0,i.I)(),t=(0,a.useForm)({mode:"onChange",delayError:void 0,shouldFocusError:!0,shouldUnregister:!1,reValidateMode:"onChange",criteriaMode:"firstError",defaultValues:r.S,resolver:(0,o.X)(e),shouldUseNativeValidation:!1}),n=t.reset,s=t.control,l=t.register,c=t.setValue,u=t.getValues,d=t.handleSubmit,f=t.formState,m=f.errors,h=f.isDirty,p=f.isSubmitting;return{reset:n,errors:m,control:s,setValue:c,register:l,getValues:u,showConfirm:h&&!p,handleSubmit:d,isDisabledSubmit:!1}}},7923:function(e,t,n){n.d(t,{I:function(){return r}});var a=n(928),o=n(2889),r=function(){var e=(0,a.useIntl)().formatMessage;return(0,o.object)({start_frequency:(0,o.number)(),channel_number:(0,o.number)(),point_number:(0,o.number)(),rssi_offset:(0,o.number)(),masked:(0,o.string)(),file:(0,o.object)(),text:(0,o.string)().when(["switch"],(function(t){return t?(0,o.string)().min(3,e({id:"thisFieldShouldBeAtLeast"},{length:3})).max(15,e({id:"thisFieldShouldNotBeLongerThen"},{length:15})).matches(/[0-9A-Za-z]/g,e({id:"invalidCharacters"})).required(e({id:"thisFieldCannotBeEmpty"})):(0,o.string)()})),textarea:(0,o.string)(),select:(0,o.string)(),radio:(0,o.string)(),switch:(0,o.boolean)(),number:(0,o.string)(),numbers:(0,o.array)().when(["switch"],(function(t){return t?(0,o.array)().min(1,e({id:"youCannotAddLessThanMinItems"},{min:1})).max(3,e({id:"youCannotAddMoreThanMaxItems"},{max:3})):(0,o.array)()}))})}},1160:function(e,t,n){n.d(t,{C:function(){return b}});var a=n(928),o=n(9749),r=n(272),i=n(4072),s=n(6929),l=n(1985),c=n(866),u=n(1477),d=n(555),f=n(8422),m=n(9538),h=n(6417),p=(0,r.makeStyles)(f.z,{name:"ConfigurationTab"}),b=function(){var e=p(),t=(0,a.useIntl)().formatMessage,n=(0,u.t)(),r=n.reset,f=n.control,b=n.handleSubmit,g=(0,d.Q)({reset:r}),x=g.xaxis,S=g.yaxis,v=g.data,C=g.showResult,y=g.isConnected,F=g.isStartLoad,k=g.isStopLoad,T=g.isEnabled,w=g.handleStart,I=g.handleStop,E=g.handleEnable;return(0,h.jsx)("div",{children:(0,h.jsxs)("form",{onSubmit:b(w),className:e.form,children:[(0,h.jsx)(i.FormBlock,{label:t({id:"enableService"}),children:(0,h.jsx)(c.SwitchField,{label:t({id:"Enable"}),checked:T,onChange:E,tooltipText:"If you enable spectral scan, other LoRa service will be stopped."})}),T&&(0,h.jsxs)(i.FormBlock,{label:t({id:"option"}),children:[(0,h.jsxs)("div",{className:e.formBlock,children:[(0,h.jsx)(l.TextFormField,{name:"start_frequency",shouldUnregister:!0,control:f,label:t({id:"startFrequency"})}),(0,h.jsx)(l.TextFormField,{name:"channel_number",shouldUnregister:!0,control:f,label:t({id:"channelNumber"})}),(0,h.jsx)(l.TextFormField,{name:"step",shouldUnregister:!0,control:f,label:t({id:"step"})})]}),(0,h.jsxs)("div",{className:e.formBlock,children:[(0,h.jsx)(s.CustomButton,{type:"submit",variant:"contained",customSize:"small",disabled:y,loading:F,additionalClass:e.submit,children:t({id:"startScan"})}),(0,h.jsx)(s.CustomButton,{variant:"contained",customSize:"small",disabled:!y,loading:k,onClick:I,additionalClass:e.submit,children:t({id:"stopScan"})})]})]}),C&&T&&(0,h.jsx)(m.n,{xaxis:x,yaxis:S,data:v}),(0,h.jsx)(o.DevTool,{control:f})]})})}},8422:function(e,t,n){n.d(t,{z:function(){return s}});var a=n(4942),o=n(1413),r=n(272),i=n(7959),s=function(e){var t;return(0,r.createStyles)({form:(0,o.Z)((0,o.Z)({},(0,i.formWrapExpansion)(e)),{},(0,a.Z)({background:e.custom.white,minHeight:"calc(100vh - 300px)",boxSizing:"border-box",padding:"60px 30px"},e.breakpoints.down(e.breakpoints.values.mobile),{padding:"32px 20px"})),formBlock:(t={maxWidth:"368px",display:"grid",gap:"24px",gridTemplateColumns:"168px 168px","& #mui-component-select-select:focus":{backgroundColor:"transparent"}},(0,a.Z)(t,e.breakpoints.down(e.breakpoints.values.mobile),{paddingBottom:"20px"}),(0,a.Z)(t,"marginBottom","36px"),t),infoBlock:{maxWidth:"368px"},submit:{height:"48px",width:"120px"},loaderWrap:{width:"fit-content",margin:"20% auto"},circle:{color:e.palette.primary.light},fieldWithPills:{display:"grid",gridTemplateColumns:"168px 1fr",gridColumnGap:"32px"},pillsList:{padding:"20px 0 0 0",display:"flex",flexWrap:"wrap",gridColumn:"span 2"},addButton:{width:"80px",alignSelf:"start",transform:"translate(-11px, 22px)"},heatMap:{display:"grid",placeItems:"center"},dataTable:{width:"100%",borderCollapse:"collapse"},tableHeader:{backgroundColor:"#f2f2f2"},tableCell:{border:"1px solid #ddd",padding:"8px",textAlign:"left"},tableRow:{"&:hover":{backgroundColor:"lightblue"}}})}},5619:function(e,t,n){n.d(t,{h:function(){return l}});var a=n(928),o=n(6660),r=n(1610),i=n(5773),s=n(6417),l=function(e){var t=e.activeTab,n=e.breadcrumbs,l=e.handleChangeTab,c=(0,a.useIntl)().formatMessage,u=i.AR.map((function(e){var t=e.name;return{value:e.value,name:c({id:t})}})),d=n.map((function(e){return c({id:e})}));return(0,s.jsx)(o.PageHeader,{withCustomElement:!0,activeTab:t,tabs:u,handleChangeTab:l,title:(0,s.jsx)(a.FormattedMessage,{id:"spectralScan"}),customElement:(0,s.jsx)(r.Breadcrumbs,{breadcrumbs:d})})}},5773:function(e,t,n){var a;n.d(t,{AR:function(){return o},Kb:function(){return r},dI:function(){return a}}),function(e){e.CONFIGURATION="configuration"}(a||(a={}));var o=[{value:a.CONFIGURATION,name:"configuration"}],r=["extensions","spectralScan"]},520:function(e,t,n){n.d(t,{C:function(){return i}});var a=n(9439),o=n(3264),r=n(5773),i=function(){var e=(0,o.useState)(r.dI.CONFIGURATION),t=(0,a.Z)(e,2),n=t[0],i=t[1],s=(0,o.useCallback)((function(e,t){n!==r.dI.CONFIGURATION&&i(t)}),[n]);return{activeTab:n,breadcrumbs:r.Kb,handleChangeTab:s}}},5219:function(e,t,n){n.r(t);var a=n(928),o=n(5619),r=n(1160),i=n(7823),s=n(5773),l=n(520),c=n(6417);t.default=function(){var e=(0,l.C)(),t=e.activeTab,n=e.breadcrumbs,u=e.handleChangeTab;return(0,c.jsx)(a.IntlProvider,{locale:"en",messages:i.I.en,children:(0,c.jsxs)("div",{children:[(0,c.jsx)(o.h,{activeTab:t,breadcrumbs:n,handleChangeTab:u}),t===s.dI.CONFIGURATION&&(0,c.jsx)(r.C,{})]})})}},8104:function(e,t,n){n.d(t,{G:function(){return s},n:function(){return c}});var a=n(9439),o=n(9165),r=n(8158),i=(0,o.createRequestAction)({type:"GET_ENABLE",payload:function(){return{url:r.H.enable,method:"GET"}}}),s=(0,a.Z)(i,1)[0],l=(0,o.createRequestAction)({type:"SET_ENABLE",payload:function(e){var t=e.data;return{url:r.H.enable,method:"PUT",data:t}},meta:{skipToast:!0}}),c=(0,a.Z)(l,1)[0]},8158:function(e,t,n){n.d(t,{H:function(){return a}});var a={enable:"/extensions/com_rak_spectral_scan/enable"}},7823:function(e,t,n){n.d(t,{I:function(){return a}});var a={en:n(4773)}},4773:function(e){e.exports=JSON.parse('{"extensions":"Extensions","configuration":"Configuration","spectralScan":"Spectral Scan","enable":"Enable","enableService":"Enable Service","option":"Scan Configuration","startFrequency":"Start Frequency (KHz)","channelNumber":"Channel Number","step":"Steps (KHz)","rssiOffset":"RSSI Offset (dB)","result":"Scan Result","startScan":"Start","stopScan":"Stop","thisFieldShouldBeAtLeast":"This field should be at least {length} character(s) long.","thisFieldShouldNotBeLongerThen":"This field should not be longer than {length}.","invalidCharacters":"Invalid characters. Please check the input.","thisFieldCannotBeEmpty":"This field cannot be empty."}')}}]);